---
id: 'Q7DCL45FVR6rWvltVihAv'
title: '노드JS는 싱글 스레드가 아니다'
description: '자바스크립트는 싱글 스레드에서 실행될지 몰라도 자바스크립트 런타임 노드JS는 아닙니다.'
createdAt: '2022-07-27T17:02:27.730Z'
updatedAt:
author: 'nw.lee'
draft: false
tags:
  [
    '노드JS',
    '시스템 콜',
    '파일-입출력',
    '암호화',
    '비동기',
    '프로미스',
    '논블로킹',
  ]
---

물론 자바스크립트는 싱글 스레드에서 실행된다. 자바스크립트는 논 블로킹 특성을 보유하고 있고 네트워크 및 입출력 로직이 이벤트와 콜백으로 수행된다.

## Node.js

노드JS는 자바스크립트 런타임으로써 여러 개의 스레드를 사용한다. 자바스크립트를 구동하는 V8 엔진과 비동기 입출력을 지원하는 C 라이브러리 libuv로 이뤄져 있다. 자바스크립트 코드 실행 중 파일 입출력, 네트워크 통신, 타이머, 암호화 등등의 작업을 하게 되면 자바스크립트가 실행되는 스레드가 아닌, 다른 스레드에 넘겨 시스템 콜을 호출하거나 해당 작업을 실행하도록 한다.

노드JS에서는 시스템 콜을 수행하는 동안 메인 스레드를 점유하는 함수, 메인 스레드 대신 다른 스레드에서 시스템 콜을 수행하도록 하는 함수가 각각 존재한다. 대표적으로 `fs.readFileSync` 그리고 `fs.readFile` 이 있다.

프로미스는 첨부된 비동기 작업(콜백 함수)이 완전히 종료되었는지 실패했는지 나타내주는 객체이다.

`fs/promises` 패키지의 경우 프로미스를 반환하는 비동기 함수로 구성되어 있다. 이 함수들은 파일 입출력을 수행할 때 메인 스레드를 점유하지 않는다. 프로미스 객체를 반환하기 때문에 `async/await` 문법으로 코드를 깔끔하게 작성할 수 있는 것은 덤이다.

`async` 가 명시된 함수는 이벤트 루프를 통해 비동기적으로 처리된다. `await` 구문을 만나게 되면 프로미스 작업이 끝날 때까지 함수의 동작을 중지시킨다. 해당 작업이 처리되는 동안 자바스크립트는 다른 일을 수행할 수 있다. 비동기 작업이 끝나서 프로미스 작업의 결과값을 받으면 함수의 실행이 재개된다.
